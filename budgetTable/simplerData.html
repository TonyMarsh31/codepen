<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Query Budget Information</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!--    table stuff-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.3/js/jquery.tablesorter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/colresizable/1.6.0/colResizable-1.6.js"
            integrity="sha512-0HfjrMq6p8VBkVjp/gy/obELN81BCwmKRd7fongBsAPw49BeKAfXpQn6PWSPa8rm7mvblqyV2P1kVNzvW6qR4Q=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!--    font-->
    <link rel='stylesheet'
          href='https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkai/dist/LXGWWenKai-Bold/result.css'/>
    <link rel='stylesheet' href='https://chinese-fonts-cdn.deno.dev/packages/syst/dist/SourceHanSerifCN/result.css'/>

    <script>
        $(document).ready(function () {
            const theTable = $("#resultsTable");
            theTable.tablesorter();
            theTable.colResizable({
                liveDrag: true,
                // gripInnerHtml: "<div class='grip'></div>",
                // draggingClass: "dragging",
                // resizeMode: 'fit'
            });
        });
    </script>
    <link href="css.css" rel="stylesheet"/>

    <script>
        function applyFilters() {
            let inputYYZT = document.getElementById('filterEntity').value.toLowerCase();
            let inputYYKM = document.getElementById('filterAccount').value.toLowerCase();
            let table = document.getElementById('resultsTable');
            let tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) { // Start from 1 to skip the header row
                let tdEntity = tr[i].getElementsByTagName('td')[0];
                let tdAccount = tr[i].getElementsByTagName('td')[1];
                if (tdEntity && tdAccount) {
                    let textYYZT = tdEntity.textContent || tdEntity.innerText;
                    let textYYKM = tdAccount.textContent || tdAccount.innerText;
                    if (textYYZT.toLowerCase().indexOf(inputYYZT) > -1 &&
                        textYYKM.toLowerCase().indexOf(inputYYKM) > -1
                    ) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    </script>

    <script>
        <!-- double click -->
        document.addEventListener('DOMContentLoaded', function () {
            const cells = document.querySelectorAll('td');
            cells.forEach(cell => {
                cell.addEventListener('dblclick', function () {
                    const range = document.createRange();
                    range.selectNodeContents(this);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                });
            });
        });
    </script>

    <script>
        function exportToCSV() {
            var csv = [];
            var rows = document.querySelectorAll("table tr");
            csv.push('\uFEFF');
            for (var i = 0; i < rows.length; i++) {
                var row = [], cols = rows[i].querySelectorAll("td, th");
                for (var j = 0; j < cols.length; j++)
                    row.push('"' + cols[j].innerText.replace(/"/g, '""') + '"');
                csv.push(row.join(","));
            }
            downloadCSV(csv.join("\n"), 'table-data.csv');
        }

        function downloadCSV(csv, filename) {
            var csvFile;
            var downloadLink;
            csvFile = new Blob([csv], {type: "text/csv;charset=utf-8;"});
            downloadLink = document.createElement("a");
            downloadLink.download = filename;
            downloadLink.href = window.URL.createObjectURL(csvFile);
            downloadLink.style.display = "none";
            document.body.appendChild(downloadLink);
            downloadLink.click();
        }

    </script>


</head>

<body>
<!--<h2>负数可用预算</h2>-->

<div class="filter-section">
    <label for="filterEntity">预算主体</label>
    <input type="text" id="filterEntity" placeholder="永达">
    <label for="filterAccount">预算科目</label>
    <input type="text" id="filterAccount" placeholder="浮动绩效">
    <button onclick="applyFilters()">筛选</button>
    <button onclick="exportToCSV()">保存到本地</button>
</div>

<table id="resultsTable">
    <thead>
    <tr>
        <th>主体</th>
        <th>科目</th>
        <th>区间可用</th>
        <th>区间</th>
    </tr>
    </thead>
    <tbody>
    <!-- Results will be appended here -->
    <tr>
        <td>永达集团职能中心</td>
        <td>浮动绩效</td>
        <td>-14281600.45</td>
        <td>年控</td>
    </tr>
    <tr>
        <td>新能源汽车服务产业发展筹备组</td>
        <td>客户关系管理费</td>
        <td>-16967.48</td>
        <td>年控</td>
    </tr>
    <tr>
        <td>永达小鹏上海浦西售后服务中心</td>
        <td>售后运杂燃油费</td>
        <td>-215</td>
        <td>年控</td>
    </tr>
    <tr>
        <td>永达小鹏上海南汇4S店</td>
        <td>固定薪酬</td>
        <td>-379898.82</td>
        <td>年控</td>
    </tr>
    <tr>
        <td>永达小鹏上海金桥服务中心</td>
        <td>售后运杂燃油费</td>
        <td>-77669.81</td>
        <td>年控</td>
    </tr>
    <tr>
        <td>永达小鹏上海浦东康桥360展厅</td>
        <td>固定薪酬</td>
        <td>-316227.51</td>
        <td>年控</td>
    </tr>
    <tr>
        <td>永达小鹏上海浦东康桥360展厅</td>
        <td>浮动绩效</td>
        <td>-404662.37</td>
        <td>年控</td>
    </tr>
    </tbody>
</table>
</body>
</html>